<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>CosmoDance Chat</title>
<style>
body { font-family: sans-serif; background: #111; color: #fff; }
#chat { width: 500px; margin: 40px auto; }
.msg { padding: 8px; margin-bottom: 6px; }
.you { background: #222; }
.bot { background: #1b3; white-space: pre-line; }
</style>
</head>
<body>

<div id="chat"></div>

<input id="input" type="text" style="width:500px; margin:10px auto; display:block;" placeholder="Напишите вопрос…" />

<script>
const uid = "user_" + Math.random().toString(36).slice(2);
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const TYPING_SPEED = 40; // мс

function addYou(text){
  const d=document.createElement("div");
  d.className="msg you";
  d.innerText=text;
  chat.appendChild(d);
}

async function addBot(text){
  const d=document.createElement("div");
  d.className="msg bot";
  chat.appendChild(d);

  for(let i=0;i<text.length;i++){
    d.innerText+=text[i];
    await new Promise(ok=>setTimeout(ok,TYPING_SPEED));
  }
}

input.addEventListener("keydown",async(e)=>{
  if(e.key==="Enter"){
    const msg=input.value.trim();
    if(!msg) return;
    addYou(msg);
    
    const r = await fetch("/chat",{
      method:"POST",
      headers:{ "Content-Type":"application/json"},
      body:JSON.stringify({userId:uid, message:msg})
    });

    const j= await r.json();
    await addBot(j.reply);
    input.value="";
  }
});
</script>

</body>
</html>

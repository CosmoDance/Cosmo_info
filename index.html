<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>CosmoDance ‚Äî —á–∞—Ç-–±–æ—Ç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #0b0b12;
        color: #ffffff;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 16px;
      }

      .chat-wrapper {
        width: 100%;
        max-width: 420px;
        height: 90vh;
        max-height: 720px;
        background: #141421;
        border-radius: 16px;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .chat-header {
        padding: 12px 16px;
        background: linear-gradient(135deg, #6b4bff, #c23fff);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chat-header-title {
        font-size: 16px;
        font-weight: 600;
      }

      .chat-header-sub {
        font-size: 12px;
        opacity: 0.9;
      }

      .chat-header-right {
        font-size: 11px;
        opacity: 0.9;
      }

      .chat-messages {
        flex: 1;
        padding: 12px;
        overflow-y: auto;
        background: radial-gradient(circle at top, #272744 0, #141421 55%);
      }

      .bubble {
        max-width: 80%;
        padding: 8px 10px;
        margin-bottom: 8px;
        border-radius: 12px;
        font-size: 14px;
        line-height: 1.4;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .bubble.user {
        background: #3a3a55;
        margin-left: auto;
        border-bottom-right-radius: 2px;
      }

      .bubble.bot {
        background: #1d1d2b;
        margin-right: auto;
        border-bottom-left-radius: 2px;
      }

      .bubble.system {
        background: transparent;
        color: #c3c3ff;
        font-size: 12px;
        text-align: center;
        margin: 8px auto;
      }

      .chat-input-wrapper {
        padding: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        background: #141421;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .chat-input-wrapper input {
        flex: 1;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: #0c0c16;
        color: #ffffff;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
      }

      .chat-input-wrapper input:focus {
        border-color: #6b4bff;
      }

      .chat-input-wrapper input:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .chat-input-wrapper button {
        padding: 8px 12px;
        border-radius: 999px;
        border: none;
        background: #6b4bff;
        color: #ffffff;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.2s, transform 0.1s;
      }

      .chat-input-wrapper button:hover {
        opacity: 0.9;
      }

      .chat-input-wrapper button:active {
        transform: translateY(1px);
      }

      .chat-input-wrapper button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .chat-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 10px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        background: #12121f;
      }

      .chat-footer button {
        border: none;
        background: transparent;
        color: #c3c3ff;
        font-size: 11px;
        cursor: pointer;
        text-decoration: underline;
        padding: 2px 4px;
      }

      .chat-footer button:hover {
        opacity: 0.8;
      }

      .typing-indicator {
        font-size: 11px;
        color: #a0a0ff;
        margin-bottom: 6px;
        padding-left: 12px;
        font-style: italic;
      }

      .error-message {
        font-size: 12px;
        color: #ff9a9a;
        margin: 4px 12px 8px;
        padding: 6px 8px;
        background: rgba(255, 0, 0, 0.1);
        border-radius: 6px;
        display: none;
      }

      ::-webkit-scrollbar {
        width: 6px;
      }
      
      ::-webkit-scrollbar-thumb {
        background: #3a3a55;
        border-radius: 3px;
      }
      
      ::-webkit-scrollbar-track {
        background: transparent;
      }
    </style>
  </head>
  <body>
    <div class="chat-wrapper">
      <div class="chat-header">
        <div>
          <div class="chat-header-title">CosmoDance –±–æ—Ç</div>
          <div class="chat-header-sub">–í–æ–ø—Ä–æ—Å—ã –æ —Å—Ç—É–¥–∏–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</div>
        </div>
        <div class="chat-header-right">AI Assistant</div>
      </div>

      <div id="messages" class="chat-messages">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
      </div>

      <div id="typingIndicator" class="typing-indicator" style="display: none;">
        CosmoDance –±–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...
      </div>

      <div id="errorMessage" class="error-message" style="display: none;"></div>

      <div class="chat-footer">
        <span id="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
        <button id="resetBtn" type="button">–ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</button>
      </div>

      <div class="chat-input-wrapper">
        <input
          id="userInput"
          type="text"
          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –æ CosmoDance‚Ä¶"
          disabled
        />
        <button id="sendBtn" type="button" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <script>
      // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
      const TYPING_SPEED = 40; // –º—Å –Ω–∞ —Å–∏–º–≤–æ–ª
      const INACTIVITY_LIMIT_MS = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
      const MAX_MESSAGE_LENGTH = 1000;
      
      // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä!
      // –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: "http://localhost:3000/chat"
      // –î–ª—è Render.com: "https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.onrender.com/chat"
      const API_URL = (() => {
        const hostname = window.location.hostname;
        const protocol = window.location.protocol;
        
        // –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          return 'http://localhost:3000/chat';
        }
        
        // GitHub Pages –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ —Ö–æ—Å—Ç–∏–Ω–≥–∏ (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ)
        if (hostname.includes('github.io') || hostname.includes('netlify.app')) {
          // ‚ö†Ô∏è –£–ö–ê–ñ–ò–¢–ï –†–ï–ê–õ–¨–ù–´–ô URL –í–ê–®–ï–ì–û –°–ï–†–í–ï–†–ê:
          return 'https://cosmo-info.onrender.com/chat';
        }
        
        // –ü—Ä–æ–¥–∞–∫—à–µ–Ω (–µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –∏ –±–µ–∫ –Ω–∞ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ)
        return '/chat';
      })();

      // ==================== –≠–õ–ï–ú–ï–ù–¢–´ DOM ====================
      const messagesEl = document.getElementById("messages");
      const userInput = document.getElementById("userInput");
      const sendBtn = document.getElementById("sendBtn");
      const resetBtn = document.getElementById("resetBtn");
      const statusEl = document.getElementById("status");
      const typingIndicator = document.getElementById("typingIndicator");
      const errorMessageEl = document.getElementById("errorMessage");

      // ==================== –°–û–°–¢–û–Ø–ù–ò–ï ====================
      let history = []; // [{role:'user'|'assistant', content:'...'}]
      let isBotTyping = false;
      let typingTimeout = null;

      const STORAGE_KEY = "cosmo_chat_history_v1";
      const STORAGE_LAST_ACTIVITY = "cosmo_chat_last_activity";

      // ==================== –§–£–ù–ö–¶–ò–ò ====================

      function showError(message) {
        errorMessageEl.textContent = message;
        errorMessageEl.style.display = 'block';
        setTimeout(() => {
          errorMessageEl.style.display = 'none';
        }, 5000);
      }

      function setStatus(text) {
        statusEl.textContent = text;
      }

      function scrollToBottom() {
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function saveHistory() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
          localStorage.setItem(STORAGE_LAST_ACTIVITY, String(Date.now()));
        } catch (e) {
          console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:", e);
        }
      }

      function loadHistory() {
        try {
          const last = localStorage.getItem(STORAGE_LAST_ACTIVITY);
          if (last) {
            const diff = Date.now() - Number(last);
            if (diff > INACTIVITY_LIMIT_MS) {
              localStorage.removeItem(STORAGE_KEY);
              localStorage.removeItem(STORAGE_LAST_ACTIVITY);
              return;
            }
          }

          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const arr = JSON.parse(raw);
          if (Array.isArray(arr)) {
            history = arr.slice(-20); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            history.forEach((m) => {
              addMessageBubble(m.role, m.content, false);
            });
            scrollToBottom();
          }
        } catch (e) {
          console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:", e);
        }
      }

      function addMessageBubble(role, text, save = true) {
        const div = document.createElement("div");
        if (role === "system") {
          div.className = "bubble system";
        } else {
          div.className = "bubble " + (role === "user" ? "user" : "bot");
        }
        div.textContent = text;
        messagesEl.appendChild(div);
        
        if (save && (role === "user" || role === "assistant")) {
          history.push({
            role: role === "assistant" ? "assistant" : "user",
            content: text,
          });
          saveHistory();
        }
        
        scrollToBottom();
      }

      function showTyping(show) {
        typingIndicator.style.display = show ? 'block' : 'none';
        if (show) scrollToBottom();
      }

      async function showBotReplyAnimated(text) {
        // –°–æ–∑–¥–∞–µ–º –ø—É–∑—ã—Ä—å –¥–ª—è –±–æ—Ç–∞
        const bubble = document.createElement("div");
        bubble.className = "bubble bot";
        bubble.textContent = "";
        messagesEl.appendChild(bubble);
        scrollToBottom();

        let i = 0;
        const len = text.length;

        await new Promise((resolve) => {
          function typeNext() {
            if (i >= len) {
              resolve();
              return;
            }
            bubble.textContent += text[i];
            i += 1;
            if (i % 10 === 0 || i >= len) {
              scrollToBottom();
            }
            typingTimeout = setTimeout(typeNext, TYPING_SPEED);
          }
          typeNext();
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç
        history.push({ role: "assistant", content: text });
        saveHistory();
        scrollToBottom();
      }

      async function sendMessage() {
        if (isBotTyping) return;

        const text = userInput.value.trim();
        if (!text) return;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
        if (text.length > MAX_MESSAGE_LENGTH) {
          showError(`–°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (${text.length} —Å–∏–º–≤–æ–ª–æ–≤). –ú–∞–∫—Å–∏–º—É–º: ${MAX_MESSAGE_LENGTH}`);
          return;
        }

        addMessageBubble("user", text, true);
        userInput.value = "";

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        isBotTyping = true;
        sendBtn.disabled = true;
        userInput.disabled = true;
        sendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
        setStatus("–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...");
        showTyping(true);

        try {
          const payload = {
            message: text,
            history: history,
          };

          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 30000);

          const response = await fetch(API_URL, {
            method: "POST",
            headers: { 
              "Content-Type": "application/json",
              "Accept": "application/json"
            },
            body: JSON.stringify(payload),
            signal: controller.signal
          });

          clearTimeout(timeoutId);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          const reply = data.reply || "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.";

          showTyping(false);
          await showBotReplyAnimated(reply);
          
        } catch (e) {
          console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", e);
          showTyping(false);
          
          let errorMessage = "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. ";
          
          if (e.name === 'AbortError') {
            errorMessage = "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
          } else if (e.message.includes('Failed to fetch')) {
            errorMessage = "–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.";
          } else if (e.message.includes('HTTP 429')) {
            errorMessage = "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.";
          } else if (e.message.includes('HTTP 5')) {
            errorMessage = "–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
          }
          
          addMessageBubble("assistant", errorMessage + " –ö–æ–¥ –æ—à–∏–±–∫–∏: " + e.message, true);
          showError(errorMessage);
          
        } finally {
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
          isBotTyping = false;
          sendBtn.disabled = false;
          userInput.disabled = false;
          sendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å";
          userInput.focus();
          setStatus("–û–Ω–ª–∞–π–Ω");
        }
      }

      function resetChat() {
        if (isBotTyping) {
          if (!confirm("–ë–æ—Ç —Å–µ–π—á–∞—Å –æ—Ç–≤–µ—á–∞–µ—Ç. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥?")) {
            return;
          }
        }
        
        history = [];
        isBotTyping = false;
        clearTimeout(typingTimeout);
        typingTimeout = null;
        messagesEl.innerHTML = "";
        
        try {
          localStorage.removeItem(STORAGE_KEY);
          localStorage.removeItem(STORAGE_LAST_ACTIVITY);
        } catch (e) {
          console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:", e);
        }
        
        setStatus("–û–Ω–ª–∞–π–Ω");
        addMessageBubble(
          "system",
          "üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø —á–∞—Ç-–±–æ—Ç —Å—Ç—É–¥–∏–∏ —Ç–∞–Ω—Ü–µ–≤ CosmoDance.\n\n" +
          "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å:\n" +
          "‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π\n" +
          "‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º–∏\n" +
          "‚Ä¢ –í—ã–±–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n" +
          "‚Ä¢ –ó–∞–ø–∏—Å—å—é –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ\n" +
          "‚Ä¢ –û—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n\n" +
          "–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ —Å—Ç—É–¥–∏–∏ CosmoDance!",
          false
        );
        
        userInput.focus();
      }

      function checkServerHealth() {
        const healthUrl = API_URL.replace('/chat', '/health');
        
        fetch(healthUrl, { 
          method: 'GET',
          headers: { 'Accept': 'application/json' }
        })
          .then(response => {
            if (response.ok) {
              setStatus("–û–Ω–ª–∞–π–Ω");
              userInput.disabled = false;
              sendBtn.disabled = false;
              userInput.placeholder = "–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –æ CosmoDance‚Ä¶";
            } else {
              throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç');
            }
          })
          .catch(error => {
            console.warn("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:", error);
            setStatus("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
            userInput.disabled = true;
            sendBtn.disabled = true;
            userInput.placeholder = "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
            showError("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä —á–∞—Ç–∞.");
          });
      }

      // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================

      sendBtn.addEventListener("click", sendMessage);

      userInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      resetBtn.addEventListener("click", resetChat);

      // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
      userInput.addEventListener("focus", () => {
        userInput.style.borderColor = "#6b4bff";
      });
      
      userInput.addEventListener("blur", () => {
        userInput.style.borderColor = "rgba(255, 255, 255, 0.14)";
      });

      // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

      window.addEventListener('DOMContentLoaded', () => {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
        loadHistory();
        
        // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        if (history.length === 0) {
          addMessageBubble(
            "system",
            "üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø —á–∞—Ç-–±–æ—Ç —Å—Ç—É–¥–∏–∏ —Ç–∞–Ω—Ü–µ–≤ CosmoDance.\n\n" +
            "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å:\n" +
            "‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–Ω—è—Ç–∏–π\n" +
            "‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º–∏\n" +
            "‚Ä¢ –í—ã–±–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n" +
            "‚Ä¢ –ó–∞–ø–∏—Å—å—é –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ\n" +
            "‚Ä¢ –û—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n\n" +
            "–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –æ —Å—Ç—É–¥–∏–∏ CosmoDance!",
            false
          );
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä
        checkServerHealth();
        
        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å
        userInput.focus();
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –ø—Ä–∏ –¥–æ–ª–≥–æ–º –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏
        setInterval(() => {
          try {
            const last = localStorage.getItem(STORAGE_LAST_ACTIVITY);
            if (last) {
              const diff = Date.now() - Number(last);
              if (diff > INACTIVITY_LIMIT_MS && history.length > 0) {
                console.log("–ê–≤—Ç–æ—Å–±—Ä–æ—Å –∏–∑-–∑–∞ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è");
                resetChat();
              }
            }
          } catch (e) {
            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
          }
        }, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
      });
    </script>
  </body>
</html>
